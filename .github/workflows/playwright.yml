name: sites-workability-checking

on:
    schedule:
        - cron: '0 6 * * *' # каждый день в 9:00 по МСК
    workflow_dispatch:

jobs:
    run_tests:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Run tests inside Playwright container
              uses: addnab/docker-run-action@v3
              with:
                  image: mcr.microsoft.com/playwright:v1.51.1
                  options: -v ${{ github.workspace }}:/work -w /work
                  run: |
                      npm install
                      npx playwright test --reporter=html --grep 'Проверка рабоспособности сайта 1tm.ru'
                      mkdir -p /tmp/playwright-report
                      cp -r playwright-report/* /tmp/playwright-report/

            - name: Upload report
              uses: actions/upload-artifact@v3
              with:
                  name: playwright-html-report
                  path: /tmp/playwright-report/
                  retention-days: 3
