name: Playwright Tests

on:
    schedule:
        - cron: '0 6 * * *'
    workflow_dispatch:
    push:
        branches:
            - '**'

jobs:
    run_tests:
        runs-on: ubuntu-latest
        container:
            image: mcr.microsoft.com/playwright:v1.51.1

        steps:
            - name: Checkout code
              uses: actions/checkout@v3 # Используем v3 вместо v4

            - name: Install dependencies
              run: npm ci

            - name: Run Playwright tests
              run: |
                  npx playwright test --grep 'Проверка работоспособности сайта 1tm.ru' --reporter=html
              continue-on-error: true

            - name: Upload HTML report
              if: always()
              uses: actions/upload-artifact@v1
              with:
                  name: playwright-html-report
                  path: playwright-report/
                  retention-days: 7

            - name: Print report location
              if: always()
              run: |
                  echo "HTML report available as artifact: playwright-html-report"
                  echo "Download link: https://github.com/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID"
