name: Playwright Tests

on:
    schedule:
        - cron: '0 6 * * *'
    workflow_dispatch:
    push:
        branches:
            - '**'

jobs:
    run_tests:
        runs-on: ubuntu-latest
        container:
            image: mcr.microsoft.com/playwright:v1.51.1
        steps:
            - name: Checkout code
              uses: actions/checkout@v4 # Обновлено до последней версии

            - name: Install dependencies
              run: npm ci # Используем ci вместо install для более надежной установки

            - name: Run Playwright tests with HTML report
              run: |
                  npx playwright test --grep 'Проверка работоспособности сайта 1tm.ru' --reporter=html
              continue-on-error: true # Продолжить workflow даже при падении тестов

            - name: Upload HTML report
              if: always() # Загружать отчет в любом случае
              uses: actions/upload-artifact@v3
              with:
                  name: playwright-html-report
                  path: playwright-report/
                  retention-days: 7

            - name: Print report location
              if: always()
              run: |
                  echo "HTML report available as artifact: playwright-html-report"
                  echo "Or via direct link: https://github.com/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID"
